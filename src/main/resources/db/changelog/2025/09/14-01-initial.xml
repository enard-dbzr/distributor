<?xml version="1.0" encoding="UTF-8"?>
<databaseChangeLog
        xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog
                      http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-4.33.xsd"
        objectQuotingStrategy="QUOTE_ONLY_RESERVED_WORDS">
    <changeSet id="1757794523271-1" author="enard">
        <createTable tableName="attachments">
            <column autoIncrement="true" name="id" type="BIGINT">
                <constraints nullable="false" primaryKey="true" primaryKeyName="pk_attachments"/>
            </column>
            <column name="type" type="VARCHAR(31)">
                <constraints nullable="false"/>
            </column>
            <column name="text" type="VARCHAR(255)"/>
            <column name="tag" type="VARCHAR(255)"/>
            <column name="content_id" type="BIGINT"/>
        </createTable>
    </changeSet>
    <changeSet id="1757794523271-2" author="enard">
        <createTable tableName="chats">
            <column autoIncrement="true" name="id" type="BIGINT">
                <constraints nullable="false" primaryKey="true" primaryKeyName="pk_chats"/>
            </column>
            <column name="user_id" type="BIGINT"/>
        </createTable>
    </changeSet>
    <changeSet id="1757794523271-3" author="enard">
        <createTable tableName="feedback_payloads">
            <column autoIncrement="true" name="id" type="BIGINT">
                <constraints nullable="false" primaryKey="true" primaryKeyName="pk_feedback_payloads"/>
            </column>
            <column name="type" type="VARCHAR(31)">
                <constraints nullable="false"/>
            </column>
            <column name="reply_to_id" type="BIGINT"/>
            <column name="tag" type="VARCHAR(255)"/>
            <column name="content_id" type="BIGINT"/>
        </createTable>
    </changeSet>
    <changeSet id="1757794523271-4" author="enard">
        <createTable tableName="feedbacks">
            <column autoIncrement="true" name="id" type="BIGINT">
                <constraints nullable="false" primaryKey="true" primaryKeyName="pk_feedbacks"/>
            </column>
            <column name="action_time" type="DATETIME"/>
            <column name="chat_id" type="BIGINT"/>
            <column name="payload_id" type="BIGINT"/>
        </createTable>
    </changeSet>
    <changeSet id="1757794523271-5" author="enard">
        <createTable tableName="frame_contexts">
            <column name="chat_id" type="BIGINT">
                <constraints nullable="false" primaryKey="true" primaryKeyName="pk_frame_contexts"/>
            </column>
            <column name="snapshot" type="TEXT">
                <constraints nullable="false"/>
            </column>
        </createTable>
    </changeSet>
    <changeSet id="1757794523271-6" author="enard">
        <createTable tableName="integrations">
            <column autoIncrement="true" name="id" type="BIGINT">
                <constraints nullable="false" primaryKey="true" primaryKeyName="pk_integrations"/>
            </column>
            <column name="webhook_url" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
            <column name="token" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
        </createTable>
    </changeSet>
    <changeSet id="1757794523271-7" author="enard">
        <createTable tableName="message_contents">
            <column autoIncrement="true" name="id" type="BIGINT">
                <constraints nullable="false" primaryKey="true" primaryKeyName="pk_message_contents"/>
            </column>
            <column name="type" type="VARCHAR(31)">
                <constraints nullable="false"/>
            </column>
            <column name="text" type="VARCHAR(255)"/>
        </createTable>
    </changeSet>
    <changeSet id="1757794523271-8" author="enard">
        <createTable tableName="message_states">
            <column autoIncrement="true" name="id" type="BIGINT">
                <constraints nullable="false" primaryKey="true" primaryKeyName="pk_message_states"/>
            </column>
            <column name="type" type="VARCHAR(31)">
                <constraints nullable="false"/>
            </column>
            <column name="receive_time" type="DATETIME"/>
            <column name="transfer_time" type="DATETIME"/>
        </createTable>
    </changeSet>
    <changeSet id="1757794523271-9" author="enard">
        <createTable tableName="messages">
            <column autoIncrement="true" name="id" type="BIGINT">
                <constraints nullable="false" primaryKey="true" primaryKeyName="pk_messages"/>
            </column>
            <column name="sender_id" type="BIGINT"/>
            <column name="recipient_id" type="BIGINT"/>
            <column name="state_id" type="BIGINT"/>
            <column name="content_id" type="BIGINT"/>
        </createTable>
    </changeSet>
    <changeSet id="1757794523271-10" author="enard">
        <createTable tableName="participants">
            <column autoIncrement="true" name="id" type="BIGINT">
                <constraints nullable="false" primaryKey="true" primaryKeyName="pk_participants"/>
            </column>
            <column name="type" type="VARCHAR(31)">
                <constraints nullable="false"/>
            </column>
            <column name="chat_id" type="BIGINT"/>
            <column name="service_id" type="BIGINT"/>
        </createTable>
    </changeSet>
    <changeSet id="1757794523271-11" author="enard">
        <createTable tableName="sessions">
            <column autoIncrement="true" name="id" type="BIGINT">
                <constraints nullable="false" primaryKey="true" primaryKeyName="pk_sessions"/>
            </column>
            <column name="chat_id" type="BIGINT">
                <constraints nullable="false"/>
            </column>
            <column name="service_id" type="BIGINT">
                <constraints nullable="false"/>
            </column>
            <column name="state" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
            <column name="open_time" type="DATETIME">
                <constraints nullable="false"/>
            </column>
            <column name="close_time" type="DATETIME"/>
        </createTable>
    </changeSet>
    <changeSet id="1757794523271-12" author="enard">
        <createTable tableName="tg_chat_links">
            <column name="chat_id" type="BIGINT">
                <constraints nullable="false" primaryKey="true" primaryKeyName="pk_tg_chat_links"/>
            </column>
            <column name="tg_chat_id" type="BIGINT">
                <constraints nullable="false"/>
            </column>
        </createTable>
    </changeSet>
    <changeSet id="1757794523271-13" author="enard">
        <createTable tableName="tg_message_links">
            <column name="message_id" type="BIGINT">
                <constraints nullable="false" primaryKey="true" primaryKeyName="pk_tg_message_links"/>
            </column>
            <column name="tg_message_id" type="INT">
                <constraints nullable="false"/>
            </column>
            <column name="tg_chat_id" type="BIGINT">
                <constraints nullable="false"/>
            </column>
        </createTable>
    </changeSet>
    <changeSet id="1757794523271-14" author="enard">
        <createTable tableName="users">
            <column autoIncrement="true" name="id" type="BIGINT">
                <constraints nullable="false" primaryKey="true" primaryKeyName="pk_users"/>
            </column>
            <column name="name" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
            <column name="email" type="VARCHAR(255)"/>
            <column name="age" type="INT"/>
            <column name="city" type="VARCHAR(255)"/>
            <column name="hobby" type="VARCHAR(255)"/>
        </createTable>
    </changeSet>
    <changeSet id="1757794523271-15" author="enard">
        <addUniqueConstraint columnNames="payload_id" constraintName="uc_feedbacks_payload" tableName="feedbacks"/>
    </changeSet>
    <changeSet id="1757794523271-16" author="enard">
        <addUniqueConstraint columnNames="token" constraintName="uc_integrations_token" tableName="integrations"/>
    </changeSet>
    <changeSet id="1757794523271-17" author="enard">
        <addUniqueConstraint columnNames="webhook_url" constraintName="uc_integrations_webhookurl"
                tableName="integrations"/>
    </changeSet>
    <changeSet id="1757794523271-18" author="enard">
        <addUniqueConstraint columnNames="content_id" constraintName="uc_messages_content" tableName="messages"/>
    </changeSet>
    <changeSet id="1757794523271-19" author="enard">
        <addUniqueConstraint columnNames="recipient_id" constraintName="uc_messages_recipient" tableName="messages"/>
    </changeSet>
    <changeSet id="1757794523271-20" author="enard">
        <addUniqueConstraint columnNames="sender_id" constraintName="uc_messages_sender" tableName="messages"/>
    </changeSet>
    <changeSet id="1757794523271-21" author="enard">
        <addUniqueConstraint columnNames="state_id" constraintName="uc_messages_state" tableName="messages"/>
    </changeSet>
    <changeSet id="1757794523271-22" author="enard">
        <addUniqueConstraint columnNames="tg_chat_id" constraintName="uc_tg_chat_links_tg_chat"
                tableName="tg_chat_links"/>
    </changeSet>
    <changeSet id="1757794523271-23" author="enard">
        <addForeignKeyConstraint baseColumnNames="content_id" baseTableName="attachments"
                constraintName="FK_ATTACHMENTS_ON_CONTENT" referencedColumnNames="id"
                referencedTableName="message_contents"/>
    </changeSet>
    <changeSet id="1757794523271-24" author="enard">
        <addForeignKeyConstraint baseColumnNames="payload_id" baseTableName="feedbacks"
                constraintName="FK_FEEDBACKS_ON_PAYLOAD" referencedColumnNames="id"
                referencedTableName="feedback_payloads"/>
    </changeSet>
    <changeSet id="1757794523271-25" author="enard">
        <addForeignKeyConstraint baseColumnNames="content_id" baseTableName="messages"
                constraintName="FK_MESSAGES_ON_CONTENT" referencedColumnNames="id"
                referencedTableName="message_contents"/>
    </changeSet>
    <changeSet id="1757794523271-26" author="enard">
        <addForeignKeyConstraint baseColumnNames="recipient_id" baseTableName="messages"
                constraintName="FK_MESSAGES_ON_RECIPIENT" referencedColumnNames="id"
                referencedTableName="participants"/>
    </changeSet>
    <changeSet id="1757794523271-27" author="enard">
        <addForeignKeyConstraint baseColumnNames="sender_id" baseTableName="messages"
                constraintName="FK_MESSAGES_ON_SENDER" referencedColumnNames="id" referencedTableName="participants"/>
    </changeSet>
    <changeSet id="1757794523271-28" author="enard">
        <addForeignKeyConstraint baseColumnNames="state_id" baseTableName="messages"
                constraintName="FK_MESSAGES_ON_STATE" referencedColumnNames="id" referencedTableName="message_states"/>
    </changeSet>

</databaseChangeLog>